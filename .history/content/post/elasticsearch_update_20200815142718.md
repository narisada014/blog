---
title: "Elasticsearch 5.6.3を7.4に上げた"
date: 2020-08-15T14:12:54+09:00
draft: false
---

# 苦労したところ
1. シノニムの読み込み方法の変更
Elasticsearchの5系から6系にアップデートされた時点で劇的な変更が...
synonymファイルをfilterに入れるとトークン化されてしまう。  
つまり、「資生堂,SHISEIDO,しせいどう」などがシノニムファイルに定義されている場合、  
「し,せい,どう」のように分割されてしまい、6系以上では検索時のノイズの原因になってしまう。  

2. typelessにAPIが変更されていた
5系まではindexを作成する際にtypeを指定していた。  
しかし7系からそれは非推奨になっており、既存のまま叩くと例外が発生する始末。  

3. 辞書とシノニムは運用時に随時追加しているのでテストの構成を変えた
AWSのElasticsearchでは2020年の春まで個別でsynonymファイル、辞書ファイルを定義して、  
必要な時に随時更新することができなった。そのため2017年に作成された現システムではEC2にElasticsearchをインストールし、そこにsynonymや辞書ファイルを持つことで新しい商品追加時などの辞書登録に対応している。
